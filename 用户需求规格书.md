# **📝 TjuFood 天津大学美食指南 - 用户需求规格书**

[TOC]

## 1. 引言

### 1.1 文档目的

本文档旨在作为“TjuFood 天津大学美食指南”项目的核心指导文件，详细阐述项目目标、系统角色、功能范围、业务流程及关键技术选型。本文档是项目开发、测试及未来迭代的最高纲领。

### 1.2 系统概述

“TjuFood”是一个旨在为天津大学全体师生提供一站式校园餐饮信息服务的平台。系统将以详尽的食堂、窗口、菜品数据为基础，通过用户生成内容（UGC）建立一个活跃的美食分享社区，并结合用户激励体系提升用户粘性。同时，系统将为管理者提供强大的后台功能，通过数据驱动决策，持续优化餐饮服务质量。

## 2. 非功能性需求

本章节定义了项目的技术架构选型与系统质量属性，是指导技术实现的核心规约。

| 类别         | 需求描述                                                     | 规划实现策略                                                 |
| ------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| **安全性**   | 1. 用户密码必须经过加盐和安全的哈希算法加密后存储。 <br />2. 关键API接口必须进行严格的认证和授权校验。 <br />3. 需有效防范常见的Web安全漏洞。 | 1. 后端采用 **BCrypt** 算法对密码进行加密。<br />2. 设计基于Token的认证机制，通过**拦截器(Interceptor)**对受保护的API进行访问控制。 <br />3. 全面采用预编译语句（如MyBatis-Plus）防止SQL注入；对用户输入内容进行过滤或转义以防XSS攻击。 |
| **性能**     | 1. 核心API接口的平均响应时间应控制在200毫秒以内。 <br />2. 对于高频访问的热点数据（如首页、食堂列表），应最大限度减少数据库的直接访问压力。 | 1. 对所有数据库查询的`WHERE`条件及外键关联字段**建立索引**。 <br />2. 引入 **Redis** 作为缓存层，设计并实现包含缓存穿透、击穿、雪崩解决方案的`CacheClient`工具类。 |
| **可扩展性** | 1. 系统采用分层架构，确保各模块高内聚、低耦合。<br />2. 主键生成策略需支持未来可能的分布式部署。 | 1. 后端严格遵循`Controller-Service-Mapper`三层架构，并定义清晰的DTO（数据传输对象）。 <br />2. 主键ID采用基于 **Redis 的分布式ID生成器** (`RedisIdWorker`)，不依赖数据库自增。 |
| **健壮性**   | 1. 系统需能捕获并优雅地处理所有运行时异常。 <br />2. 所有来自客户端的输入数据必须经过服务端校验。 | 1. 后端设置**全局异常处理器** (`GlobalExceptionHandler`)，统一处理异常并返回标准格式的错误信息。 <br />2. 在所有Controller的DTO参数前使用`@Validated`注解，并为DTO字段配置JSR-303校验规则。 |

## 3. 系统角色与权限

### 3.1 角色定义

- **anonymous**（未注册用户）：可以进行游客访问，进行菜品浏览、查看点评、注册账号等操作。
- **user**（已注册用户）：已通过邮箱或手机号注册，并登录后使用系统功能。可以进行菜品点评、查看菜单、获取推荐等操作。
- **admin**（后台管理员）：一个统称，根据职责细分为以下角色：
  - **内容管理员**：负责管理食堂、窗口、菜品等核心基础数据。
  - **社区管理员**：负责审核用户生成内容、处理举报、管理用户和敏感词。
  - **运营管理员**：负责平台运营活动，如轮播图、公告、优惠券等。
- **boss**（平台管理者）：拥有系统最高权限，可以管理所有管理员账号、角色权限、系统配置、核心规则及数据分析。

### 3.2 角色功能权限划分表

| 功能模块                     | 功能描述                        | anonymous | user  | admin | boss      |
| ---------------------------- | ------------------------------- | --------- | ----- | ----- | --------- |
| **账号与认证**               | 注册账号                        | ✅         | ❌     | ❌     | ❌         |
|                              | 登录系统 (账号密码)             | ❌         | ✅     | ✅     | ✅         |
|                              | 登录系统 (验证码)               | ❌         | ✅     | ❌     | ❌         |
|                              | 修改个人密码 (通过旧密码)       | ❌         | ✅     | ✅     | ✅         |
|                              | **找回密码 (通过验证码)**       | ❌         | **✅** | **❌** | **❌**     |
|                              | 管理个人信息 (昵称/头像/简介等) | ❌         | ✅     | ❌     | ✅管理所有 |
| **基础浏览**                 | 浏览菜品/食堂/窗口/校区信息     | ✅         | ✅     | ✅     | ✅         |
|                              | 查看公开的评价/评论/博客        | ✅         | ✅     | ✅     | ✅         |
| **内容创作与管理**           | 提交评价/评分                   | ❌         | ✅     | ❌     | ❌         |
|                              | 发布/编辑/删除自己的博客        | ❌         | ✅     | ❌     | ✅管理所有 |
| **后台管理 - 系统**          | **创建Admin账号 (初始化密码)**  | ❌         | ❌     | ❌     | **✅**     |
|                              | 任命/解除 Admin                 | ❌         | ❌     | ❌     | ✅         |
|                              | 管理角色与权限                  | ❌         | ❌     | ❌     | ✅         |
| ... (其他权限行保持不变) ... |                                 |           |       |       |           |

*说明：*

- ✅：表示该角色拥有此项功能权限。
- ❌：表示该角色通常不拥有此项功能权限。
- 后台`admin`的权限由`boss`通过角色进行分配。

## 4. 系统功能需求详解

### **A级功能（必须实现）**

#### **账号管理**

- **用户注册**：`anonymous` 用户通过邮箱或手机号注册，创建账户成为 `user`。密码需符合复杂度要求并进行安全的 **BCrypt** 加密存储。
- **用户登录**：
  - `user`、各类`admin`、`boss` 用户通过账号密码登录系统，获取认证Token。
  - （B级功能）`user` 也可通过验证码登录。
- **密码修改与安全**：
  - `admin` 和 `boss` 可在登录后，通过提供原密码的方式修改自己的登录密码。
  - `user` 可通过提供原密码的方式修改密码。
- **角色与权限管理 (`boss`)**：`boss` 可以管理角色 (`tb_role`)、权限 (`tb_permission`) 及其关联 (`tb_role_permission`, `tb_admin_role`)。
- **管理员创建 (`boss`)**：`boss` 创建 `admin` 账号时，系统将其密码初始化为一个预设的简单密码（如'123456'），并**强制要求该 `admin` 在首次登录后必须修改密码**，以确保账户安全。

#### **普通用户核心功能**

- **信息检索与浏览**：用户可以按校区、食堂、窗口、菜系、菜品名称等条件检索，查看详细信息。
- **评价与评分**：用户可以对**窗口** (`tb_stall`) 进行图文评价 (`tb_stall_review`)，并给出1-5星的各项评分。评价需 `社区管理员` 审核。
- **发表/管理博客 (笔记)**：用户可以发布图文并茂的美食博客 (`tb_blog`)，关联食堂/窗口/菜品，并可以编辑或删除自己的博客。
- **发表/管理评论**：用户可以对博客或其他评论进行评论 (`tb_comment`)，或回复其他评论。评论需 `社区管理员` 审核。
- **点赞/取消点赞**：用户可以对博客、评价、评论、菜品进行点赞或取消点赞 (`tb_like`)。
- **收藏/取消收藏**：用户可以收藏博客、窗口等 (`tb_favorite`)。

#### **管理员核心功能**

- **内容审核 (`社区管理员`)**：审核用户提交的评价、评论、博客，通过或拒绝。
- **内容管理 (`社区管理员`)**：隐藏或删除不符合规定的用户发布内容。
- **基础数据管理 (`内容管理员`)**：管理校区 (`tb_campus`)、食堂类型 (`tb_canteen_type`)、食堂 (`tb_canteen`)、窗口类型 (`tb_stall_type`)、窗口 (`tb_stall`)、菜品 (`tb_dish`) 的信息。
- **公告管理 (`运营管理员`)**：发布、编辑、下线系统公告 (`tb_notice`)。
- **举报处理 (`社区管理员`)**：查看用户举报 (`tb_report`) 并进行处理。

### **B级功能（建议实现）**

#### **用户交互优化**

- **验证码登录/找回密码 (`user`专属)**：**(针对`user`角色)** 提供邮箱或短信验证码用于登录或找回密码。**`admin`及`boss`角色不使用此功能**，其密码由`boss`重置或自行修改。
- **关注/取关用户**：用户可以关注其他用户 (`tb_follow`)，建立社交关系。
- **消息通知**：当用户的内容被点赞或评论时，系统应通过站内信 (`tb_notification`) 发送通知。

#### **用户激励机制**

- **积分系统**：用户通过签到 (`tb_sign`)、发布内容等行为获得积分。系统需记录详细的积分变动 (`tb_credit_record`)。
- **优惠券系统**：`运营管理员` 可创建优惠券模板 (`tb_voucher`)，用户可通过积分兑换或活动领取。
- **积分排行榜**：展示全站用户的积分排名，激励用户参与。

### **C级功能（可选实现）**

#### **高级功能与优化**

- **个性化推荐**：根据用户的浏览历史 (`tb_search_history`)、收藏和点赞行为，为其推荐可能感兴趣的菜品或窗口。
- **AI智能助手**：
  - **目标**：利用大语言模型（LLM），结合系统内的菜品、评价等本地知识库，提供智能问答服务。
  - **场景示例**：在菜品详情页提供“与AI对话”的入口，用户可以提问“这道菜辣不辣？”、“大家对这道菜的评价怎么样？”等问题。
  - **技术规划**：后端通过`RestTemplate`或`WebClient`调用外部LLM API，将本地数据（如菜品描述、热门评价）作为上下文（Context）与用户问题一同提交，获取并返回智能回答。